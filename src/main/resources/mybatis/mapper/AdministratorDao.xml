<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xupt.bookshop.dao.AdministratorDao">


    <resultMap id="FinishedItemInfoForQuery" type="com.xupt.bookshop.model.admin.FinishedItemInfoForQuery">
        <result column="item_Id" property="itemId"/>
        <result column="item_name" property="itemName"/>
        <result column="seller_qtalk" property="sellerQtalk"/>
        <result column="state" property="state"
                typeHandler="com.qunar.base.meerkat.orm.mybatis.type.CodeEnumTypeHandler"/>
        <result column="start_time" property="startTime" jdbcType="TIMESTAMP" javaType="org.joda.time.DateTime"
                typeHandler="com.xupt.bookshop.dao.typeHandler.DateTimeTypeHandler"/>
        <result column="end_time" property="time" jdbcType="TIMESTAMP" javaType="org.joda.time.DateTime"
                typeHandler="com.xupt.bookshop.dao.typeHandler.DateTimeTypeHandler"/>
        <result column="starting_price" property="startPrice" jdbcType="DECIMAL" javaType="qunar.api.pojo.Money"
                typeHandler="com.xupt.bookshop.dao.typeHandler.MoneyTypeHandler"/>
        <result column="step_price" property="stepPrice" jdbcType="DECIMAL" javaType="qunar.api.pojo.Money"
                typeHandler="com.xupt.bookshop.dao.typeHandler.MoneyTypeHandler"/>
        <result column="final_price" property="finalPrice" jdbcType="DECIMAL" javaType="qunar.api.pojo.Money"
                typeHandler="com.xupt.bookshop.dao.typeHandler.MoneyTypeHandler"/>
        <result column="old_degree" property="oldDegree"
                typeHandler="com.qunar.base.meerkat.orm.mybatis.type.CodeEnumTypeHandler"/>
        <result column="auction_count" property="auctionCount"/>
        <result column="browse_count" property="browseCount"/>
        <result column="subscription_count" property="subscriptionCount"/>
    </resultMap>
    <sql id="finishedItemInfoForQueryField">
        (item_id, item_name, seller_qtalk, state, start_time, end_time,
        starting_price, step_price, final_price, old_degree, auction_count,
        browse_count, subscription_count)
    </sql>
    <select id="queryFinishedItemList" resultMap="FinishedItemInfoForQuery">
        SELECT
        <include refid="finishedItemInfoForQueryField"/>
        FROM finished_item_fixed_info
    </select>

    <resultMap id="UnFinishedItemInfoForQuery" type="com.xupt.bookshop.model.admin.UnfinishedItemForQuery">
        <result column="item_Id" property="itemId"/>
        <result column="item_name" property="itemName"/>
        <result column="state" property="state"/>
        <result column="start_time" property="startTime" jdbcType="TIMESTAMP" javaType="org.joda.time.DateTime"
                typeHandler="com.xupt.bookshop.dao.typeHandler.DateTimeTypeHandler"/>
        <result column="end_time" property="time" jdbcType="TIMESTAMP" javaType="org.joda.time.DateTime"
                typeHandler="com.xupt.bookshop.dao.typeHandler.DateTimeTypeHandler"/>
        <result column="start_price" property="startPrice" jdbcType="DECIMAL" javaType="qunar.api.pojo.Money"
                typeHandler="com.xupt.bookshop.dao.typeHandler.MoneyTypeHandler"/>
        <result column="step_price" property="stepPrice" jdbcType="DECIMAL" javaType="qunar.api.pojo.Money"/>
        <result column="current_price" property="currentPrice" jdbcType="DECIMAL" javaType="qunar.api.pojo.Money"
                typeHandler="com.xupt.bookshop.dao.typeHandler.MoneyTypeHandler"/>
        <result column="old_degree" property="oldDegree"
                typeHandler="com.qunar.base.meerkat.orm.mybatis.type.CodeEnumTypeHandler"/>
        <result column="auction_count" property="auctionCount"/>
        <result column="browse_count" property="browseCount"/>
        <result column="subscription_count" property="subscriptionCount"/>
    </resultMap>
    <sql id="unFinishedItemInfoForQueryField">
        (item_id, item_name, seller_qtalk, state, start_time, end_time,
        start_price, step_price, current_price, auction_count, subscription_count, browse_count)
    </sql>
    <select id="queryUnfinishedItemList" resultMap="UnFinishedItemInfoForQuery">
        SELECT
        <include refid="unFinishedItemInfoForQueryField"/>
        FROM unfinished_item_fixed_info AS fixed
        LEFT JOIN unfinished_item_dynamic_info AS dynamic
        ON fixed.item_id = dynamic.item_id
        WHERE
        fixed.state = #{state}
    </select>

    <insert id="addAdministrator" keyColumn="id" keyProperty="administrator.id">
        INSERT INTO
        administrator(amdin_qtalk)
        values(#{administrator.administratorQtalk})
    </insert>

    <insert id="addCategory" keyColumn="id" keyProperty="category.id">
        INSERT INTO
        item_category(category_name)
        values(#{category.categoryName})
    </insert>

    <select id="queryAllCategories" resultType="com.xupt.bookshop.model.common.Category">
        SELECT
        id, category_name
        FROM
        item_category
    </select>

    <resultMap id="UnfinishedItemFixedInfo" type="com.xupt.bookshop.model.common.UnfinishedItemFixedInfo">
        <result column="item_Id" property="itemId"/>
        <result column="item_name" property="itemName"/>
        <result column="old_degree" property="oldDegree"
                typeHandler="com.qunar.base.meerkat.orm.mybatis.type.CodeEnumTypeHandler"/>
        <result column="category_id" property="categoryId"/>
        <result column="seller_qtalk" property="sellerQtalk"/>
        <result column="state" property="state"/>
        <result column="description" property="description"/>
        <result column="start_time" property="startTime" jdbcType="TIMESTAMP" javaType="org.joda.time.DateTime"
                typeHandler="com.xupt.bookshop.dao.typeHandler.DateTimeTypeHandler"/>
        <result column="end_time" property="endTime" jdbcType="TIMESTAMP" javaType="org.joda.time.DateTime"
                typeHandler="com.xupt.bookshop.dao.typeHandler.DateTimeTypeHandler"/>
        <result column="start_price" property="startPrice" jdbcType="DECIMAL" javaType="qunar.api.pojo.Money"
                typeHandler="com.xupt.bookshop.dao.typeHandler.MoneyTypeHandler"/>
        <result column="step_price" property="stepPrice" jdbcType="DECIMAL" javaType="qunar.api.pojo.Money"
                typeHandler="com.xupt.bookshop.dao.typeHandler.MoneyTypeHandler"/>
        <result column="reverse_price" property="reversePrice" jdbcType="DECIMAL" javaType="qunar.api.pojo.Money"
                typeHandler="com.xupt.bookshop.dao.typeHandler.MoneyTypeHandler"/>
    </resultMap>
    <sql id="unfinishedItemFixedInfoField">
        (item_id, item_name, old_degree, category_id, seller_qtalk, state,
        description, start_time, end_time, start_price, step_price, reserve_price)
    </sql>
    <select id="queryUnfinishedItemFixedInfoById" resultMap="UnfinishedItemFixedInfo">
        SELECT
        <include refid="unfinishedItemFixedInfoField"/>
        FROM
        unfinished_item_fixed_info AS fixed
        <where>
            <if test="itemId != null">
                fixed.item_id = itemId
            </if>
        </where>
    </select>

    <resultMap id="UnfinishedItemDynamicInfo" type="com.xupt.bookshop.model.common.UnfinishedItemDynamicInfo">
        <result column="item_Id" property="itemId"/>
        <result column="current_price" property="stepPrice" jdbcType="DECIMAL" javaType="qunar.api.pojo.Money"
                typeHandler="com.xupt.bookshop.dao.typeHandler.MoneyTypeHandler"/>
        <result column="current_bidder_qtalk" property="currentBidderQtalk"/>
        <result column="auction_count" property="auctionCount"/>
        <result column="browse_count" property="browseCount"/>
        <result column="subscription_count" property="subscriptionCount"/>
    </resultMap>
    <sql id="unfinishedItemDynamicInfoField">
        (item_id, current_price, current_bidder_qtalk, auction_count, subscription_count, browse_count)
    </sql>
    <select id="queryUnfinishedItemDynamicInfoById" resultMap="UnfinishedItemDynamicInfo">
        SELECT
        <include refid="unfinishedItemDynamicInfoField"/>
        FROM
        unfinished_item_dynamic_info AS dynamic
        <where>
            <if test="itemId != null">
                dynamic.item_id = itemId
            </if>
        </where>
    </select>

    <sql id="finishedItemField">
        (item_id, item_name, old_degree, category_id, seller_qtalk, buyer_qtalk, state,
        description, start_time, end_time, starting_price, step_price, reserve_price,
        final_price, auction_count, subscription_count, browse_count)
    </sql>
    <insert id="addFinishedItem" keyColumn="id" keyProperty="finishedItemInfo.id">
        INSERT INTO
        finished_item_fixed_info
        <include refid="finishedItemField"/>
        VALUES
        (
        #{finishedItemInfo.itemId}, #{finishedItemInfo.itemName},
        #{finishedItemInfo.itemId}, #{finishedItemInfo.categoryId}, #{finishedItemInfo.sellerQtalk},
        #{finishedItemInfo.buyerQtalk}, #{finishedItemInfo.state}, #{finishedItemInfo.description},
        #{finishedItemInfo.startTime}, #{finishedItemInfo.time}, #{finishedItemInfo.startPrice},
        #{finishedItemInfo.stepPrice}, #{finishedItemInfo.reversePrice}, #{finishedItemInfo.finalPrice},
        #{finishedItemInfo.auctionCount}, #{finishedItemInfo.subscriptionCount}, #{finishedItemInfo.browseCount}
        )
    </insert>

    <select id="selectAdminByQtalk" resultType="com.xupt.bookshop.model.admin.Administrator">
        SELECT
        id AS id,
        admin_qtalk AS administratorQtalk
        FROM administrator
        WHERE
        admin_qtalk = #{qtalk}
    </select>

    <delete id="deleteUnfinishedItemFixedInfoByItemId">
      DELETE FROM
      unfinished_item_fixed_info
      WHERE
      item_id = #{itemId}
    </delete>

    <delete id="deleteUnfinishedItemDynamicInfoByItemId">
        DELETE FROM
        unfinished_item_dynamic_info
        WHERE
        item_id = #{itemId}
    </delete>


</mapper>