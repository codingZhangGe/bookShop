<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xupt.bookshop.dao.HomeDao">

    <sql id="selectFields">
             book.book_id,book.book_name,book.price,book.category_name,book.state,book.current_price,book.discount,book_dynamic_info.browse_count,book_dynamic_info.buy_count
    </sql>

    <select id="queryAllCategory" resultType="com.xupt.bookshop.model.Category.Category">
        SELECT
        category_id,
        category_name,
        parent_id
        FROM category
        WHERE parent_id
        IN(
        SELECT category_id
        FROM category
        WHERE  category_name=#{parentId})
    </select>

    <select id="querParentCategory" resultType="com.xupt.bookshop.model.Category.Category">
        SELECT
         category_id,
        category_name
        FROM category
        WHERE parent_id=0;
    </select>
    <!--首页展示的拍品信息 默认标准,全部类别商品,价格随机排序,
            商品id ,    类别id,
            浏览人数,   购买人数,
            当前价格,   折扣价格,
            商品名称     折扣
            -->
    <resultMap id="queryBookItem" type="com.xupt.bookshop.model.home.BookingPo">
        <!-- 静态信息 -->
        <result column="book_Id" property="bookId"/>
        <result column="book_name" property="bookName"/>
        <result column="category_name" property="categoryName"/>
        <result column="current_price" property="currentPrice" />
        <result column="price" property="Price" />
        <result column="discount" property="discount"/>
        <!-- 动态信息 -->
        <result column="browse_count" property="browseCount"/>
        <result column="buy_count" property="buyCount"/>
        <result column="state" property="bookState" typeHandler="BookStateEnumTypeHandler"/>

    </resultMap>
    <!--order by  buy Count-->
    <select id="queryBookingPo" resultMap="queryBookItem">
        SELECT
        <include refid="selectFields"/>
        FROM book
        LEFT JOIN book_dynamic_info
        ON book.book_id=book_dynamic_info.book_id
        ORDER BY buy_count
    </select>

    <!--类别查询-->
    <select id="queryBookingPoByCategory" parameterType="String" resultMap="queryBookItem">
        SELECT
        <include refid="selectFields"/>
        FROM book
        LEFT JOIN book_dynamic_info
        ON book.book_id=book_dynamic_info.book_id
        WHERE category_name=#{categoryName}
        ORDER BY buy_count
    </select>


    <select id="queryBookingPoByState" parameterType="Integer" resultMap="queryBookItem">
        SELECT
        <include refid="selectFields"/>
        FROM book
        LEFT JOIN book_dynamic_info
        ON book.book_id=book_dynamic_info.book_id
        WHERE state=#{state}
        ORDER BY buy_count
    </select>


    <select id="queryBookingPoByStateAndCategory" resultMap="queryBookItem">
        SELECT
        <include refid="selectFields"/>
        FROM book
        LEFT JOIN book_dynamic_info
        ON book.book_id=book_dynamic_info.book_id
        WHERE state=#{state}
        AND
        category_name=#{categoryName}
        ORDER BY buy_count
    </select>


<!--图书总数-->
 <select id="queryBookPages"  resultType="Integer">
     SELECT COUNT(id) FROM book
 </select>

<!--根据状态查询总数-->
    <select id="queryBookPagesByState"  parameterType="int" resultType="Integer">
        SELECT COUNT(id) FROM book
        WHERE state=#{state}
    </select>
<!--根据类别查询总数-->
    <select id="queryBookPagesByCategory" parameterType="String" resultType="Integer">
        SELECT COUNT(id) FROM book
        WHERE category_name =#{categoryName}
    </select>
    <!--根据类别和状态-->
    <select id="queryBookPagesByCategoryAndState"  resultType="Integer">
        SELECT COUNT(id) FROM book
        WHERE category_name =#{categoryName}
        AND
        state=#{state}
    </select>

</mapper>