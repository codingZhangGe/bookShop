<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC
        "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.xupt.bookshop.dao.UploadItemDao">
    <sql id="selectField">
        (
           book_id,book_name,description,price,current_price,discount,category_name,publish,author,
           surplus,publish_date,state
        )
    </sql>
    <insert id="insertItem" parameterType="com.xupt.bookshop.model.upload.UploadItemParam">
        INSERT INTO book
        <include refid="selectField"/>
        VALUES(
         #{item.bookId}
        ,#{item.bookName}
        ,#{item.description}
        ,#{item.price}
        ,#{item.currentPrice}
        ,#{item.discount}
        ,#{item.categoryName}
        ,#{item.publish}
        ,#{item.author}
        ,#{item.surplus}
        ,#{item.publishDate,typeHandler=DateTimeTypeHandler}
        ,#{item.state,typeHandler=BookStateEnumTypeHandler}

        )
    </insert>


    <insert id="insertBookDynamicItem" parameterType="com.xupt.bookshop.model.upload.UploadItemParam">
        INSERT INTO book_dynamic_info(book_id)
        VALUES(
        #{item.bookId}
        )

    </insert>


    <!--添加分类-->

    <insert id="insertCategory"  useGeneratedKeys="true" keyColumn="category_id" keyProperty="category.id" parameterType="com.xupt.bookshop.model.Category.Category">
        INSERT INTO
        category(category_name,parent_id)
        values
        (#{category.categoryName},#{category.parentId})
    </insert>

    <select id="selectParentCategoryId" resultType="int">
        SELECT category_id
        FROM category
        WHERE category_name =#{parentName}
    </select>

</mapper>