<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qunar.qauction.dao.AuctiondynamicItemDao">


    <!--更新浏览人数-->
    <update id="updateBrowserCount" parameterType="String">
        UPDATE unfinished_item_dynamic_info
        SET browse_count=browse_count+1
        WHERE item_id=#{itemId}
    </update>
    <!--更新竞拍人数,当前价格,出价方qtalk-->
    <update id="updateAuctionCountAndPrice" parameterType="com.qunar.qauction.model.auctiondetails.param.UpdateDynamic">
        UPDATE unfinished_item_dynamic_info
        SET auction_count=auction_count+1,
        current_price=#{currentPrice,typeHandler=com.qunar.qauction.dao.typeHandler.MoneyTypeHandler},
        current_bidder_qtalk=#{bidderQtalk}
        WHERE item_id=#{itemId}
    </update>
    <!--根据id查询商品信息-->
    <resultMap id="dynamicItem" type="com.qunar.qauction.model.common.UnfinishedItemDynamicInfo">
        <result column="item_id" property="itemId"/>
        <result column="current_price" property="currentPrice" jdbcType="DECIMAL" javaType="qunar.api.pojo.Money"
                typeHandler="com.qunar.qauction.dao.typeHandler.MoneyTypeHandler"/>
        <result column="auction_count" property="auctionCount"/>
        <result column="browse_count" property="browseCount"/>
    </resultMap>

    <select id="queryAuctiondynamicainfoById" parameterType="String" resultMap="dynamicItem">
        SELECT item_id,current_price,auction_count,browse_count FROM unfinished_item_dynamic_info WHERE
        item_id=#{itemId}
    </select>


    <insert id="insertAuctiondynamicaInfo" parameterType="com.qunar.qauction.model.common.UnfinishedItemDynamicInfo">
        INSERT INTO unfinished_item_dynamic_info (item_id, current_price, auction_count, browse_count,subscription_count)
        VALUES (#{itemId},#{currentPrice ,typeHandler=com.qunar.qauction.dao.typeHandler.MoneyTypeHandler},#{auctionCount},#{browseCount},#{subscriptionCount})
    </insert>

    <insert id="createAuctionOrder" parameterType="com.qunar.qauction.model.common.AuctionOrderModel">
        INSERT INTO auction_order (item_id, bidder_qtalk, auction_price, auction_time)
        VALUES (#{itemId},#{bidderQtalk},#{auctionPrice,typeHandler=com.qunar.qauction.dao.typeHandler.MoneyTypeHandler},#{auctionTime,typeHandler=com.qunar.qauction.dao.typeHandler.DateTimeTypeHandler})

</insert>
</mapper>